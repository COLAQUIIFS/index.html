<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Solicitação de Reserva de Material</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f4f9;
            color: #333;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 700px;
            margin: auto;
            background: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            min-height: 200px;
        }
        h1 {
            color: #2c3e50;
        }
        label {
            display: block;
            margin: 15px 0 5px;
            font-weight: bold;
        }
        select, input[type="text"], input[type="date"], input[type="time"], textarea {
            width: 100%;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }
        .subgroup {
            margin-top: 15px;
        }
        button {
            background-color: #2c3e50;
            color: #fff;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 20px;
        }
        button:hover {
            background-color: #1a252f;
        }
        #mensagemSucesso {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #e8f5e9;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #4CAF50;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>SOLICITAÇÃO DE RESERVA DE MATERIAL</h1>
        <p>
            Este formulário destina-se à solicitação antecipada de materiais, reagentes e equipamentos necessários para a realização de práticas laboratoriais. O objetivo é garantir a organização, segurança e disponibilidade dos itens solicitados, otimizando o planejamento e a execução das atividades práticas.
        </p>
        <ul>
            <li>Preencha todos os campos obrigatórios com atenção.</li>
            <li>As solicitações devem ser enviadas com no mínimo 48 horas úteis de antecedência da data prevista para a prática.</li>
            <li>A aprovação está sujeita à disponibilidade dos materiais e à conformidade com as normas de segurança do laboratório.</li>
            <li>Em caso de dúvidas, entre em contato com a coordenação técnica do laboratório.</li>
        </ul>

        <form id="formulario" action="https://formsubmit.co/colaqui.aracaju@ifs.edu.br" method="POST">
            <input type="hidden" name="_captcha" value="false">
            <input type="hidden" name="_template" value="table">
            <input type="hidden" name="_subject" id="subject" value="Solicitação de reserva - Docente: ">

            <label for="docente">Nome do Docente:</label>
            <input type="text" id="docente" name="Nome do Docente" required>

            <label for="emailDocente">E-mail para Confirmação (Docente):</label>
            <input type="email" id="emailDocente" name="E-mail para Confirmação" placeholder="email@exemplo.com">

            <label for="data">Data da prática:</label>
            <input type="date" id="data" name="Data da prática" required min="">

            <label for="hora">Hora da prática:</label>
            <input type="time" id="hora" name="Hora da prática" required>

            <label for="atividade">Selecione a atividade:</label>
            <select id="atividade" name="Atividade" required onchange="mostrarSubgrupo()">
                <option value="">-- Escolha uma opção --</option>
                <option value="tecnicas_basicas">Técnicas Básicas de Química</option>
                <option value="fisico_quimica">Físico-Química Experimental</option>
            </select>

            <div id="subgrupo_tecnicas" class="subgroup" style="display: none;">
                <label for="pratica_tecnicas">Prática:</label>
                <select id="pratica_tecnicas" name="Prática - Técnicas Básicas">
                    <option value="Técnicas de pesagem">Técnicas de pesagem</option>
                    <option value="Medidas de volume">Medidas de volume</option>
                    <option value="Preparo de soluções">Preparo de soluções</option>
                </select>
            </div>

            <div id="subgrupo_fisico" class="subgroup" style="display: none;">
                <label for="pratica_fisico">Prática:</label>
                <select id="pratica_fisico" name="Prática - Físico-Química Experimental">
                    <option value="Ponto de fusão">Ponto de fusão</option>
                    <option value="Ponto de ebulição">Ponto de ebulição</option>
                    <option value="Condutividade elétrica">Condutividade elétrica</option>
                    <option value="pH de soluções">pH de soluções</option>
                </select>
            </div>

            <label for="observacoes">Observações Adicionais para o Experimento:</label>
            <textarea id="observacoes" name="Observações" rows="4" placeholder="Ex: trazer reagente X, usar luvas nitrílicas..."></textarea>

            <button type="submit">Enviar Solicitação</button>
        </form>

        <div id="mensagemSucesso">
            <h3 style="color: #2c3e50; margin-bottom: 15px;">✅ Reserva Solicitada com Sucesso!</h3>
            <p style="color: #4CAF50; font-size: 1.1em;">
                Obrigado por utilizar nosso sistema.<br>
                Você receberá uma confirmação por e-mail em até 24 horas úteis.
            </p>
        </div>
    </div>

    <script>
        // Funções de subgrupo
        function mostrarSubgrupo() {
            const atividade = document.getElementById('atividade').value;
            document.getElementById('subgrupo_tecnicas').style.display = 'none';
            document.getElementById('subgrupo_fisico').style.display = 'none';

            if (atividade === 'tecnicas_basicas') {
                document.getElementById('subgrupo_tecnicas').style.display = 'block';
            } else if (atividade === 'fisico_quimica') {
                document.getElementById('subgrupo_fisico').style.display = 'block';
            }
        }

        // Validação de datas e horas
        function isDiaUtil(date) {
            const dia = date.getDay();
            return dia !== 0 && dia !== 6;
        }

        function ajustarParaHorarioUtil(date) {
            const novaData = new Date(date);
            const hora = novaData.getHours();
            
            if (hora >= 19) {
                novaData.setDate(novaData.getDate() + 1);
                novaData.setHours(7, 0, 0, 0);
            } else if (hora < 7) {
                novaData.setHours(7, 0, 0, 0);
            }
            return novaData;
        }

        function calcularHorasUteisRestantes(dataSelecionada, horaSelecionada) {
            let dataInicio = ajustarParaHorarioUtil(new Date());
            let dataFim = ajustarParaHorarioUtil(new Date(`${dataSelecionada}T${horaSelecionada}`));
            
            let horasUteis = 0;
            let dataAtual = new Date(dataInicio);

            while (dataAtual < dataFim) {
                if (isDiaUtil(dataAtual)) {
                    const horaAtual = dataAtual.getHours();
                    if (horaAtual >= 7 && horaAtual < 19) {
                        horasUteis++;
                    }
                }
                dataAtual.setTime(dataAtual.getTime() + 3600000);
            }
            
            return horasUteis;
        }

        // Validação principal
        function validarFormulario() {
            const atividade = document.getElementById("atividade").value;
            const data = document.getElementById("data").value;
            const hora = document.getElementById("hora").value;
            
            if (!atividade || !data || !hora) {
                alert("Preencha todos os campos obrigatórios.");
                return false;
            }
            
            const horasUteis = calcularHorasUteisRestantes(data, hora);
            
            if (horasUteis < 48) {
                const confirmar = confirm(
                    `ATENÇÃO: Prática agendada com ${horasUteis} horas úteis de antecedência!\n\n` +
                    '• Horário útil para solicitação: 7h às 19h (dias úteis)\n' +
                    '• Pedidos após 19h considerados no próximo dia útil\n\n' +
                    'Deseja solicitar mesmo assim?'
                );
                
                return confirmar;
            }
            
            return true;
        }

        // Event listeners
        document.getElementById('formulario').addEventListener('submit', async function(event) {
            event.preventDefault();
            
            if (!validarFormulario()) return;
            
            const docente = document.getElementById('docente').value.trim();
            if (!docente) {
                alert("Por favor, preencha o nome do docente.");
                return;
            }
            
            document.getElementById('subject').value = `Solicitação de reserva - Docente: ${docente}`;
            
            const formData = new FormData(this);
            const submitButton = this.querySelector('button[type="submit"]');
            
            try {
                submitButton.disabled = true;
                submitButton.innerHTML = 'Enviando...';
                
                const response = await fetch(this.action, {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    this.style.display = 'none';
                    document.getElementById('mensagemSucesso').style.display = 'block';
                    
                    setTimeout(() => {
                        this.reset();
                        this.style.display = 'block';
                        document.getElementById('mensagemSucesso').style.display = 'none';
                        document.getElementById('subgrupo_tecnicas').style.display = 'none';
                        document.getElementById('subgrupo_fisico').style.display = 'none';
                    }, 5000);
                } else {
                    throw new Error('Falha no envio');
                }
            } catch (error) {
                alert('Erro ao enviar solicitação. Por favor, tente novamente.');
            } finally {
                submitButton.disabled = false;
                submitButton.innerHTML = 'Enviar Solicitação';
            }
        });

        // Bloqueio de datas passadas
        document.addEventListener('DOMContentLoaded', function() {
            const dataInput = document.getElementById('data');
            const hoje = new Date().toISOString().split('T')[0];
            dataInput.min = hoje;
        });
    </script>
</body>
</html>
